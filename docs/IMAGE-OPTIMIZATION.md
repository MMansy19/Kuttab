# Image Optimization Best Practices

This document outlines how to optimize images in the Kottab project to ensure fast loading times, reduce bandwidth usage, and improve Lighthouse scores.

## Automated Scripts

The project includes several scripts to help with image optimization:

1. **Convert to WebP/AVIF**: Converts images to modern formats
   ```bash
   node scripts/convert-to-webp.js
   ```

2. **Generate Responsive Versions**: Creates multiple sizes of each image for responsive loading
   ```bash
   node scripts/generate-responsive-images.js
   ```

3. **Detect Oversized Images**: Finds images that are larger than necessary
   ```bash
   node scripts/detect-oversized-images.js
   ```

4. **Check Image Optimization**: Verifies that all images use proper optimization techniques
   ```bash
   node scripts/check-images.js
   ```

All these scripts run automatically during the build process.

## Best Practices

### 1. Use the OptimizedImage Component

Always use the `OptimizedImage` component instead of the basic Next.js `Image` component or regular HTML `<img>` tags:

```tsx
import OptimizedImage from '@/components/ui/OptimizedImage';

// Good example
<OptimizedImage 
  src="/images/example.webp"
  alt="Description of the image" 
  width={320} 
  height={240} 
  className="custom-class"
  priority={isAboveTheFold}
/>

// Avoid using basic Image component directly
<Image 
  src="/images/example.jpg"
  alt="Description of the image" 
  width={600} 
  height={400} 
/>
```

### 2. Use Appropriate Image Sizes

Ensure your image dimensions closely match the displayed size. Images should not be more than 2x larger than their display size (accounting for high-DPI screens).

Recommended max dimensions by component type:
- Hero images: 1200×480px
- Cards: 640×400px
- Avatars/profile pictures: 192×192px
- Thumbnails: 320×240px
- Icons: Use SVG when possible, or limit to 96×96px

### 3. Format Choice

- **WebP/AVIF**: Use for photographs and complex images (auto-generated by our scripts)
- **SVG**: Use for logos, icons, and simple illustrations
- **PNG**: Only use for images that require transparency and cannot be SVG

### 4. Testing Image Optimization

Run Lighthouse tests to check for oversized images:
1. Open Chrome DevTools
2. Go to Lighthouse tab
3. Check "Performance" category
4. Click "Generate report"
5. Look for "Properly size images" recommendation

## How Next.js Image Optimization Works

The Next.js Image component (`<Image>`) automatically:

1. Generates responsive sizes
2. Serves the most appropriate image size based on the user's device
3. Converts images to WebP/AVIF if the browser supports it
4. Lazy loads images that are not in the viewport
5. Prevents layout shifts with proper aspect ratios

## Troubleshooting

If Lighthouse still reports oversized images:

1. Run `node scripts/detect-oversized-images.js` to identify problem images
2. Check if you're using the correct image dimensions in your components
3. Ensure `OptimizedImage` component is used consistently
4. If using custom styling, verify it doesn't upscale the image container

For any further issues, consult the [Next.js Image documentation](https://nextjs.org/docs/api-reference/next/image).
